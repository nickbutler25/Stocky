name: Run Stockwood Vale Tee Times Daily - Mad Al

on:
  schedule:
    # Run at 5:30 PM UK time on Thursdays and Fridays
    # Two schedules needed because UK switches between BST (UTC+1) and GMT (UTC+0)
    # BST: Last Sunday in March to last Sunday in October (UTC+1)
    # GMT: Last Sunday in October to last Sunday in March (UTC+0)
    - cron: '30 16 * 4-10 4,5'  # 4:30 PM UTC = 5:30 PM BST (April-October, definitely BST)
    - cron: '30 17 * 11-12,1-2 4,5'  # 5:30 PM UTC = 5:30 PM GMT (November-February, definitely GMT)
    # March is transition month - using BST time (may be 1 hour early on first few Thursdays/Fridays)
    - cron: '30 16 * 3 4,5'  # March: using BST schedule (transition happens late March)
  workflow_dispatch:  # Allows manual triggering

jobs:
  run-app:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v3

      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.13'


      # Install Google Chrome
      - name: Install Google Chrome
        run: |
          wget -q -O - https://dl.google.com/linux/direct/google-chrome-stable_current_amd64.deb > chrome.deb
          sudo dpkg -i chrome.deb
          sudo apt --fix-broken install -y

      # Install Python dependencies (webdriver-manager will handle ChromeDriver automatically)
      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt

      # Wait until 5:58 PM UK time before running the Python script



      # Run Python script
      - name: Run Python script
        run: |
          # Run the second instance of the Python script with the second set of parameters
          python program.py '{"username": "${{ vars.MAD_AL_USER }}", "password": "${{ secrets.MAD_AL_PASSWORD }}", "time_to_book": "${{ vars.SATURDAY_TIME }}"
          , "min_time": "${{ vars.SATURDAY_MIN_TIME }}", "max_time": "${{ vars.SATURDAY_MAX_TIME }}"}'


